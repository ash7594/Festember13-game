<html>

<head>
<!--FROM ASH RISES THE WORLD-->
</head>

<body BGcolor="black">

<div>
<img id="blackback" src="raining.gif"> 
</div>

<canvas id="canvass" width="1340" height="640" style="border: 2px solid black;">
</canvas>
<canvas id="tempcanvas" width="1340" height="640" style="border: 2px solid black; display: none;">
</canvas>

<div id="redover" style="opacity: 0;"></div>
<div id="scoreboard"></div>

<div id="outerover1" style="display: none;">
<font color="yellow" id="over">Game Over</font>
</div>

<div id="outerover2" style="display: none;">
<font id="deathreason" color="blue"></font>
</div>

<div id="outerover3" style="display: none;">
<font id="deathreason" color="blue"></font>
</div>

<img src="zombie1.png" id="zom1" style="display: none;"></img>
<img src="zombie2.png" id="zom2" style="display: none;"></img>
<img src="zombie3.png" id="zom3" style="display: none;"></img>
<img src="zombie4.png" id="zom4" style="display: none;"></img>
<img src="zombie5.png" id="zom5" style="display: none;"></img>
<img src="zombie6.png" id="zom6" style="display: none;"></img>
<img src="zombie7.png" id="zom7" style="display: none;"></img>
<img src="deadzombie.png" id="deadzombie" style="display: none;"></img>

<img src="bride.png" id="bridesprite" style="display: none;"></img>
<img src="gbride.png" id="gbridesprite" style="display: none;"></img>
<img src="deadbride.png" id="deadbride" style="display: none;"></img>

<img id="imgg" src="ba2.jpg" style="display: none"></img>

<img id="arrow" src="arrow.png" width="140" height="130" style="position: absolute; left: 200; top: 100; display: none;"></img>
<img id="bowanim" src="bow.png" width="1200" height="400" style="position: absolute; left:100; top: 0; display: none"></img>

<!--img id="lightning" src="light1.png" width="200" height="400" style="position: absolute; left:300; top: 10; display: block"></img>
<img id="cloud" src="clouds.png" width="200" height="100" style="position: absolute; left:400; top: 10; display: block"></img-->

<img id="zeus" src="zeus.png" width="352" height="600" style="display: none; position: absolute; left: -20px; top: 20px;"></img>

<img src="light1.png" id="light1" style="display: none;"></img>
<img src="light2.png" id="light2" style="display: none;"></img>
<img src="light3.png" id="light3" style="display: none;"></img>
<img src="light4.png" id="light4" style="display: none;"></img>

<audio autoplay loop>
  <source src="music.mp4" type="audio/mpeg">
  <source src="music.ogg" type="audio/ogg">
</audio>

</body>

<style>

#blackback{
	width: 98.2%;
	height: 640px;
	position: absolute;
	left: 0.73%;
	top: 1.51%;
	opacity: 1;
	}

#outerover1{
	position: absolute;
	left: 465px;
	top: 200px;
	}

#outerover2{
	position: absolute;
	left: 400px;
	top: 320px;
	}
	
#redover{
	background-color: red;
	position: absolute;
	left: 0px;
	top: 0px;
	width: 1366px;
	height: 667px;
	}

#over{
	text-shadow: 20px 20px 20px white;
	font-size: 80px;
	font-family: Matura MT Script Capitals;
	}

#deathreason{
	text-shadow: 10px 10px 10px black;
	font-size: 50px;
	font-family: Cooper Black;
	}	
	
#scoreboard{
	position: absolute;
	left: 8px;
	top: 5px;
	width: 1145px;
	height: 40px;
	background-color: red;
	font-family: cooper black;
	font-size: 35px;
	padding-left: 200px;
	}

#canvass{
	background-color: black;
	opacity: 0.8;
	}

#ba{
	position: absolute;
	left: 20px;
	top: 400px;
	width: 200px;
	height: 123.26px;
	display: none;
	}

#zom{
	position: absolute;
	left: 0px;
	top: 0px;
	}

</style>

<script>

window.onload=gameframe;

var c=document.getElementById("canvass");
var ctx=c.getContext('2d');
window.addEventListener("click",arrowrelease);
window.addEventListener("mousemove",bowmove);

var ximg=-256;

var temc=document.getElementById("tempcanvas");
var tctx=temc.getContext('2d');

var d=new Date();
var time=d.getTime();

var deathreason;
var lightning=0;	
var lightningpos=0;

var deg;
var x,y;
var de=0;
var dee=0;
var refx,refy;
refx=refy=0;

var maxarrow=50;
var front=-1;
var rear=-1;

var trackzimgchange=0;
var btrav=0;
var ismovearrow=0;
var isarrow=0;
var znum=10;
var controlzs=0; //controlzombiespeed

var game;
var goo=0;
var end;

var bnum=5;

//////////////////////////////
//gameplay var
//////////////////////////////

var difficulty;
var lives=3;
var points=0;
var numarrows=20; //depends on difficulty
var numdeadbrides=5;

function arrowrelease(evt)
	{
	refx=evt.clientX;
	refy=evt.clientY;
	isarrow=1;
	numarrows--;
	}

function zombie(tspeed,speed,size,posx,posy,type,timg,isdead,flag)
	{
	this.tspeed=tspeed;
	this.speed=speed;
	this.size=size;
	this.posx=posx;
	this.posy=posy;
	this.type=type;
	this.timg=timg; //traversal through image
	this.isdead=isdead;
	this.flag=flag;
	}
	
function zcreate(i)	
	{
	var tspeed=Math.floor(Math.random()*3)+1; //1-3
	var speed=Math.floor(Math.random()*25)+5;
	var size=Math.floor(Math.random()*51)+100;  //100-150
	//var posx=1340+Math.floor(Math.random()*501);
	var posx=1340+Math.floor(Math.random()*100)*i;
	var posy=640-size;
	var type=Math.floor(Math.random()*7)+1;
	var timg=-256;
	var isdead=0;
	var flag=0;
	zobject[i]=new zombie(tspeed,speed,size,posx,posy,type,timg,isdead,flag);
	}
	
function bride(posx,posy,cposx,speed,sizex,sizey,timg,isdead,flag,type)
	{
	this.speed=speed;
	this.sizex=sizex;
	this.sizey=sizey;
	this.posx=posx;
	this.cposx=cposx;
	this.posy=posy;
	this.timg=timg; //traversal through image
	this.isdead=isdead;
	this.flag=flag;
	this.type=type;
	}	
	
function bcreate(i)
	{
	var speed=Math.floor(Math.random()*16)+5;
	var sizex=Math.floor(Math.random()*51)+150;  //100-150
	var sizey=sizex*336/500;
	var posy=-200-Math.floor(Math.random()*301);
	var posx=Math.floor(Math.random()*801)+400;
	var cposx=posx;
	var timg=-500;
	var isdead=0;
	var flag=0;
	var type=Math.random();
	if(type<0.9)
		type=1;
	else
		type=2;	
	bobject[i]=new bride(posx,posy,cposx,speed,sizex,sizey,timg,isdead,flag,type);
	}

function zchange(i)
	{
	zobject[i].tspeed=Math.floor(Math.random()*3)+1; //1-3
	zobject[i].speed=Math.floor(Math.random()*16)+5;
	zobject[i].size=Math.floor(Math.random()*51)+100;  //100-150
	zobject[i].posx=1340+Math.floor(Math.random()*501);
	zobject[i].posy=640-size;
	zobject[i].type=Math.floor(Math.random()*7)+1;
	zobject[i].timg=-256;
	zobject[i].isdead=0;
	}
	
function arrows(angle,hdist,deadarrow,arrowx,arrowy)
	{
	this.angle=angle;
	this.hdist=hdist;
	this.deadarrow=deadarrow;
	this.arrowx=arrowx;
	this.arrowy=arrowy;
	}
	
var aobject=new Array(maxarrow);
	
var zobject=new Array(znum);
	for(var i=0;i<znum;i++)
		zcreate(i);

var bobject=new Array(bnum);
	for(var i=0;i<bnum;i++)
		bcreate(i);		
	
function zmove(i)
	{
	if(zobject[i].flag%7==0)
	{
	zobject[i].flag=0;
	zobject[i].posx-=(zobject[i].speed);
	if(zobject[i].timg==1280)
		zobject[i].timg=-256;	
	zobject[i].timg+=256*zobject[i].tspeed;
	}
	zobject[i].flag++;
	ctx.drawImage(document.getElementById('zom'+zobject[i].type),zobject[i].timg,0,256,256,zobject[i].posx,zobject[i].posy,zobject[i].size,zobject[i].size);
	if(zobject[i].posx<=280)
		{
		lives--;
		zcreate(i);
		}
	
	/*if(zobject[i].timg==1280)
		zobject[i].timg=-256;*/
	}
	
function zdeath(i)
	{
	if(zobject[i].posy==(640-zobject[i].size))
		zobject[i].timg=-256;
	
	zobject[i].timg+=256;
	zobject[i].posy-=15;

	ctx.drawImage(deadzombie,zobject[i].timg,0,256,256,zobject[i].posx,zobject[i].posy,zobject[i].size,zobject[i].size);
	if(zobject[i].timg>=1280)
		{
		zcreate(i);
		}
	}
	
function bfly(i)
	{
	if(bobject[i].posx>=bobject[i].cposx && bobject[i].posx<=(bobject[i].cposx+15))
		bobject[i].timg=2000;
	else	
		bobject[i].timg=2500;
		
	bobject[i].posx+=15;
	
	if(bobject[i].type==1)
		ctx.drawImage(bridesprite,bobject[i].timg,0,495,336,bobject[i].posx,bobject[i].posy,bobject[i].sizex,bobject[i].sizey);
	else if(bobject[i].type==2)
		ctx.drawImage(gbridesprite,bobject[i].timg,0,490,378,bobject[i].posx,bobject[i].posy,bobject[i].sizex,bobject[i].sizey);
	
			
	if((bobject[i].posx)>=1340)
		{
		bcreate(i);
		}
	}
	
function bmove(i)
	{
	if(bobject[i].flag%4==0)
	{
	bobject[i].flag=0;
	bobject[i].posy+=(bobject[i].speed)/3;
	if(bobject[i].timg==1500)
		bobject[i].timg=-500;
	bobject[i].timg+=500;//256*zobject[i].tspeed;
	}
	bobject[i].flag++;
	if(bobject[i].type==1)
		ctx.drawImage(bridesprite,bobject[i].timg,0,500,336,bobject[i].posx,bobject[i].posy,bobject[i].sizex,bobject[i].sizey);
	else if(bobject[i].type==2)
		ctx.drawImage(gbridesprite,bobject[i].timg,0,500,378,bobject[i].posx,bobject[i].posy,bobject[i].sizex,bobject[i].sizey);
	
	if((bobject[i].posy+bobject[i].sizey)>=540)
		{
		if(bobject[i].type==1)
			{
			points-=10;
			numarrows--;
			numdeadbrides--;
			bobject[i].isdead=1;
			}
		else if(bobject[i].type==2)
			{
			points-=50;
			numarrows-=3;
			numdeadbrides--;
			bobject[i].isdead=1;
			}	
		}
	}	
	
function bdeath(i)
	{
	//if(bobject[i].posy==(640-zobject[i].size))
	//	zobject[i].timg=-256;
	//zobject[i].timg+=256;
	bobject[i].posy+=15;

	ctx.drawImage(deadbride,0,0,523,515,bobject[i].posx+50,bobject[i].posy,bobject[i].sizey*523/515,bobject[i].sizey);
	
	for(var j=0;j<znum;j++)
		if((((bobject[i].posx+50+(bobject[i].sizey*523/515))>=(20+zobject[j].posx) && (bobject[i].posx+50+(bobject[i].sizey*523/515))<=(zobject[j].posx+zobject[j].size)) || ((bobject[i].posx+50)<=zobject[j].posx && (bobject[i].posx+50+(bobject[i].sizey*523/515))>=(zobject[j].posx+zobject[j].size)) || ((bobject[i].posx+50)>=zobject[j].posx && (bobject[i].posx+50)<=(zobject[j].posx+zobject[j].size-20))) && (bobject[i].posy>=500 && bobject[i].posy<=590) && zobject[j].isdead!=1)
			{
			zobject[j].isdead=1;
			points+=10;
			}
			
	if((bobject[i].posy)>=640)
		{
		bcreate(i);
		}
	}	
	
/*function zdie()
	{
	var xxs=x;
	for(var i=0;i<znum;i++)
		if(zobject[i].posx>xxs-50 && zobject[i].posx<xxs+50)
		{
		zobject[i].isdead=1;
		break;
		}
	}*/	
	
function bowfire()
	{
	if(refy<320)// && x>400)
	deg=-1*((Math.atan((320-refy)/(refx+266))*180/Math.PI));
	else if(refy>320)// && x>400)
	deg=(Math.atan((refy-320)/(refx+266))*180/Math.PI);
	de=parseInt(deg);

	ctx.clearRect(0,0,300,640);
	tctx.clearRect(0,0,300,640);
	
	ctx.drawImage(zeus,0,0,600,1279,-60,60,250,500);
	/*tctx.arc(-266,320,420,0,2*Math.PI);
	tctx.lineWidth=5;
	tctx.strokeStyle="black";//"#cc6600";
	tctx.stroke();*/

	tctx.save();
	tctx.translate(-266,320);

	if(de>36)
		de=36;
	else if(de<-30)
		de=-30;
	
	btrav+=600;
	//document.getElementById('aa').innerHTML=de+" "+dee;

	tctx.rotate(de*Math.PI/180);
	//tctx.drawImage(imgg,0,0,620,1006,370,-100,123.26,200);
	if(btrav<=1800)
		{
		tctx.drawImage(bowanim,btrav,0,600,1000,295,-235,240,400);
	//ctx.drawImage(temc,0,0,250,640,0,0,250,640);
		ctx.drawImage(temc,0,0,300,640,0,0,300,640);
		}
	
	tctx.restore();
	dee=de;
	
	if(btrav==1800)
		{
		if(rear==-1)
			{
			front=0;
			rear=0;
			}
		else if(rear==maxarrow-1 && front!=0)
			rear=0;
		else if((rear==maxarrow-1 && front==0) || (rear==front-1))
			{
			//do nuthin
			}
		else 
			rear++;	
			
		aobject[rear]=new arrows(de,610,0,0,0);
		btrav=0;
		isarrow=0;
		ismovearrow=1;
		}
	}
	
function movearrow(i)
	{
	ctx.save();
	ctx.translate(-266,320);

	ctx.rotate(aobject[i].angle*Math.PI/180);
	ctx.drawImage(arrow,0,0,500,500,aobject[i].hdist,-80,140,130);   //140,130  -80 is perfectly aligned
	aobject[i].hdist+=20;

	if(aobject[i].hdist==750)
		{
		ctx.drawImage(bowanim,2400,0,600,1000,302,-235,240,400);
		window.addEventListener("mousemove",bowmove);
		window.addEventListener("click",arrowrelease);
		}
		
	ctx.restore();
	
	aobject[i].arrowx=aobject[i].hdist*Math.cos(aobject[i].angle*Math.PI/180)-266;
	aobject[i].arrowy=aobject[i].hdist*Math.sin(aobject[i].angle*Math.PI/180)+320;
	
	for(var j=0;j<znum;j++)
		{
		if(zobject[j].isdead==0 && aobject[i].arrowx>=zobject[j].posx && aobject[i].arrowx<=(zobject[j].posx+zobject[j].size) && aobject[i].arrowy>=zobject[j].posy && aobject[i].arrowy<=(zobject[j].posy+zobject[j].size))
			{
			aobject[i].deadarrow=1;
			zobject[j].isdead=1;
			points+=10;
			break;
			}
		}
		
	if(aobject[i].deadarrow!=1)	
	for(var j=0;j<bnum;j++)
		{
		if(bobject[j].isdead==0 && aobject[i].arrowx>=bobject[j].posx && aobject[i].arrowx<=(bobject[j].posx+bobject[j].sizex))
			if(aobject[i].arrowy>=(bobject[j].posy+bobject[j].sizey*2/3) && aobject[i].arrowy<=(bobject[j].posy+bobject[j].sizey))
				{
				if(bobject[j].type==1)
					{
					aobject[i].deadarrow=1;
					points-=10;
					numarrows--;
					numdeadbrides--;
					bobject[j].isdead=1;
					break;
					}
				else if(bobject[j].type==2)
					{
					aobject[i].deadarrow=1;
					points-=50;
					numarrows-=3;
					numdeadbrides--;
					bobject[j].isdead=1;
					break;
					}
				}		
			else if(aobject[i].arrowy<=(bobject[j].posy+bobject[j].sizey*2/3) && aobject[i].arrowy>=(bobject[j].posy+10))
				{
				if(bobject[j].type==1)
					{
					aobject[i].deadarrow=1;  //saved girl block
					bobject[j].isdead=2;
					points+=20;
					numarrows+=3;
					break;
					}
				else if(bobject[j].type==2)
					{
					aobject[i].deadarrow=1;  //saved girl block
					bobject[j].isdead=2;
					points+=50;
					numdeadbrides++;
					numarrows+=6;
					break;
					}
				}
		}	
		
		
	if(aobject[i].arrowx>=1340 || aobject[i].arrowy>=640 || aobject[i].arrowy<=0 || aobject[i].deadarrow==1)
		{
		
		if(aobject[i].hdist<750)
			{
			ctx.save();  //For efficiency
			ctx.translate(-266,320);
			ctx.rotate(aobject[i].angle*Math.PI/180);
			
			ctx.drawImage(bowanim,2400,0,600,1000,302,-235,240,400);
			window.addEventListener("mousemove",bowmove);
			window.addEventListener("click",arrowrelease);
			
			ctx.restore();
			}
		
		if(front==rear)
			{
			front=-1;
			rear=-1;
			}
		else if(front==(maxarrow-1))
			{
			while(i>0)
				{
				aobject[i]=aobject[i-1];
				i--;
				}	
			aobject[0]=aobject[maxarrow-1];
			front=0;
			}
		else
			{
			if(i>front)
			while(i>front)
				{
				aobject[i]=aobject[i-1];
				i--;
				}
			else if(i<front)
				{
				while(i>0)
					{
					aobject[i]=aobject[i-1];
					i--;
					}
				aobject[0]=aobject[maxarrow-1];
				i=maxarrow-1;
				while(i>front)
					{
					aobject[i]=aobject[i-1];
					i--;
					}	
				}
			front++;
			}
		//console.log("0");	
		}
	
	}
	
function gameoveranim()
	{
	goo+=0.05;
	document.getElementById('redover').style.opacity=goo;
	if(goo>=1)
		{
		document.getElementById('outerover1').style.display="block";
		document.getElementById('outerover2').style.display="block";
		document.getElementById('deathreason').innerHTML=deathreason;
		clearTimeout(end);
		
		/*$.ajax({
		url: '../games/score_update.php',
		type: 'POST',
		data: {'game_id': 2, 'score': points},
		success: function(data){
		}
		});*/
		
		}
	else
		end=setTimeout(function(){gameoveranim()},100);
	}
	
function gameframe()
	{
	ctx.clearRect(270,0,1070,640);  //250,490,1090,150
	
	if(Math.random()>0.97)
		{
		lightning=Math.random();
		lightningpos=(Math.random()*1000)+280;
		if(lightning<0.25)
			ctx.drawImage(light1,0,0,336,776,lightningpos,20,100,231);
		else if(lightning<0.5)
			ctx.drawImage(light2,0,0,134,800,lightningpos,20,17,100);
		else if(lightning<0.75)
			ctx.drawImage(light3,0,0,485,768,lightningpos,20,100,158);
		else
			ctx.drawImage(light4,0,0,485,768,lightningpos,20,100,158);		
		}
	
	for(var i=0;i<znum;i++)
		if(zobject[i].isdead==0)
			zmove(i);
		else
			zdeath(i);
	
	for(var i=0;i<bnum;i++)
		if(bobject[i].isdead==0)
			bmove(i);
		else if(bobject[i].isdead==1)
			bdeath(i);
		else
			bfly(i);
	
	if(isarrow==1)
		{
		window.removeEventListener("mousemove",bowmove);
		window.removeEventListener("click",arrowrelease);
		bowfire();
		}
		
	if(rear!=-1)
		{
		if(rear>=front)
			for(var i=front;i<=rear;i++)
				movearrow(i);
		else
			{
			for(var i=front;i<maxarrow;i++)
				movearrow(i);
			for(var i=0;i<=rear;i++)
				movearrow(i);	
			}	
		}
	if(numdeadbrides>5)
		numdeadbrides=5;
	document.getElementById("scoreboard").innerHTML="SCORE: "+points+" , LIVES: "+lives+" , BRIDES DEAD: "+(5-numdeadbrides)+" , ARROWS: "+numarrows;
	//console.log(numarrows);
	if(lives<=0 || numdeadbrides<=0 || numarrows<0 || points<0)
		{
		if(numarrows<0)
			numarrows=0;
		document.getElementById("scoreboard").innerHTML="SCORE: "+points+" , LIVES: "+lives+" , BRIDES DEAD: "+(5-numdeadbrides)+" , ARROWS: "+numarrows;
		clearTimeout(game);
		if(lives<=0)
			deathreason="U don't have a cat life...";
		else if(numdeadbrides<=0)
			deathreason="It's raining brides baby...";
		else if(numarrows<=0)
			deathreason="  Arrow Apocalypse...";
		else if(points<=0)
			deathreason="Score's important too...";
		gameoveranim();
		}
	else
		game=setTimeout(function(){gameframe()},34);
	}
	
function bowmove(evt)
{
x=evt.clientX;
y=evt.clientY;

if(y<320)// && x>400)
deg=-1*((Math.atan((320-y)/(x+266))*180/Math.PI));
else if(y>320)// && x>400)
deg=(Math.atan((y-320)/(x+266))*180/Math.PI);
de=parseInt(deg);

//if(de!=dee)
//{
ctx.clearRect(0,0,300,640);
tctx.clearRect(0,0,300,640);

ctx.drawImage(zeus,0,0,600,1279,-60,60,250,500);  //352
//ctx.drawImage(haunted,0,0,263,243,0,400,263,243);

/*tctx.arc(-266,320,420,0,2*Math.PI);
tctx.lineWidth=5;
tctx.strokeStyle="black";//"#cc6600";
tctx.stroke();*/

tctx.save();
tctx.translate(-266,320);
//ctx.clearRect(-200,-200,500,500);

//x=evt.clientX;
//y=evt.clientY;

/*if(y<320)// && x>400)
deg=-1*((Math.atan((320-y)/(x+266))*180/Math.PI));
else if(y>320)// && x>400)
deg=(Math.atan((y-320)/(x+266))*180/Math.PI);
de=parseInt(deg);*/

if(de>36)
de=36;
else if(de<-30)
de=-30;

//document.getElementById('aa').innerHTML=de+" "+dee;

tctx.rotate(de*Math.PI/180);
//tctx.drawImage(imgg,0,0,620,1006,370,-100,123.26,200);
tctx.drawImage(bowanim,0,0,600,1000,295,-235,240,400);
//ctx.drawImage(temc,0,0,250,640,0,0,250,640);
ctx.drawImage(temc,0,0,300,640,0,0,300,640);
tctx.restore();
dee=de;
//}
}

</script>

</html>